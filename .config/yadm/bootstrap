#!/bin/sh

export XDG_CONFIG_HOME=~/.config

# prepare vim folders
if command -v vim >/dev/null 2>&1; then
  echo "Bootstraping Vim"
  mkdir -p "$XDG_DATA_HOME"/vim/{undo,swap,backup}
fi

# load submodules
cd "$HOME"
yadm submodule update --recursive --init

# replace yadm https repo with ssh
sed -i "s/url = https:\/\/github.com\/mipxx\/dotfiles.git/url = git@github.com:mipxx\/dotfiles.git/" $HOME/.config/yadm/repo.git/config

# sparse checkout
yadm gitconfig core.sparseCheckout true
cat << EOF > "$HOME/.config/yadm/repo.git/info/sparse-checkout"
# generated by $0
/*
!README.md
!UNLICENSE
EOF
yadm checkout --quiet
